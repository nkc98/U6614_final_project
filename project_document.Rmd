---
title: "Did Medicaid Expansion Change the Trajectory of Drug Overdose Deaths in Appalachia?"
author: "Neil Chin (nkc2124) & Nicole Yahui Wu (yw3551)"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output: 
  pdf_document:
    keep_tex: false
    fig_caption: true
    latex_engine: pdflatex
    toc: no
    toc_depth: '3'
    number_sections: yes
header-includes:
  -  \usepackage{hyperref}
  - \usepackage{placeins}
biblio-style: apsr
geometry: margin=1in
fontfamily: mathpazo
fontsize: 11pt
# spacing: double
endnote: no
urlcolor: blue

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(cache=TRUE,
                      message=FALSE, warning=FALSE, echo=FALSE,
                      fig.path='figs/',
                      cache.path = '_cache/',
                      fig.process = function(x) {
                      x2 = sub('-\\d+([.][a-z]+)$', '\\1', x)
                      if (file.rename(x, x2)) x2 else x
                      })
```

```{r}
library(tidyverse) 
library(tidycensus)
library(readxl)
library(lubridate)
library(kableExtra)
library(sf)
library(tmap)
library(panelr)
library(fixest)
library(modelsummary)
```

# Introduction

Deaths due to drug overdose are a pressing problem facing United States policymakers and society at large, with reportedly more than 932,000 people dying due to overdose since 1999 ([CDC, 2022](https://www.cdc.gov/drugoverdose/deaths/index.html)). Rates of overdose deaths increased in nearly every US state from 2013-2017, with particularly severe incidence in the Appalachian region ([CDC, 2020](https://www.cdc.gov/drugoverdose/deaths/2013-2017-increase.html); [CDC, 2021](https://www.cdc.gov/drugoverdose/deaths/2014.html)). The increase in deaths is driven primarily by the ongoing US opioid crisis, with the vast majority (>80%) of overdose deaths associated with opioid use ([CDC, 2022](https://www.cdc.gov/drugoverdose/deaths/index.html)).

In this context, we hope to assess whether expansion of the social safety net through government policy can be causally linked to reductions in drug overdose death rates. Specifically, we propose to estimate the effects of the expansion of the US Medicaid program using a panel dataset of Appalachian counties, which increased income-based eligibility for healthcare (including drug addiction treatment) in some Appalachian states, on drug overdose deaths. We hope that the findings from this study can assist policymakers in determining whether expanding access to healthcare in low-income areas is a viable policy mechanism for addressing the ongoing drug overdose crisis.

## Why Appalachia?

We focus our study on the Appalachian region for a few reasons. First, in the pre-expansion period, Medicaid was already a widely-embraced program in Appalachia relative to the rest of the country and expansion was projected to increase enrollment by tens of millions of people, indicating that our policy "treatment" of interest (i.e., Medicaid expansion) had considerable uptake ([ARC, 2012](https://www.arc.gov/wp-content/uploads/2020/06/HealthCareCostsandAccessDisparitiesinAppalachia.pdf)). That is to say, intent-to-treat (ITT) effects measured by our study should be fairly reflective of average treatment-on-treated (ATT) effects. Second, the Appalachian region is defined at the county-level, which enables us to avoid potential selection bias and small sample size issues that would confound state-level analysis. Finally, we believe that Appalachian counties are largely similar in terms on non-measurable, unobserved characteristics across state lines, meaning that they can be fairly reliably construed as pseudo “control” and “treatment” groups. As such, any given Appalachian county should not be significantly more likely to have benefited from state-level adoption of Medicaid expansion than any other, based on its innate characteristics.

\medspace

# Policy Background & Research Hypothesis

The Affordable Care Act (ACA) was passed by the United States Congress and signed into law by President Barack Obama in 2010, drastically changing the policy landscape for health care in the United States. Among the major provisions in the ACA was expanded eligibility for Medicaid (i.e., "Medicaid Expansion"), which allowed states to raise the income-eligibility threshold to 138% of the federal poverty level ([KFF, 2022](https://www.kff.org/medicaid/issue-brief/status-of-state-medicaid-expansion-decisions-interactive-map/)). 

Of the 13 states whose boundaries overlap with the broad geographical definition of Appalachia, five states (Kentucky, Maryland, New York, Ohio, and West Virginia) passed legislation mandating the expansion of Medicaid as of January 1st, 2014 ([KFF, 2022](https://www.kff.org/medicaid/issue-brief/status-of-state-medicaid-expansion-decisions-interactive-map/)). Two additional states, Pennsylvania and Virginia, would later expand Medicaid, with the former in 2015 and the latter in 2019. Six states (Alabama, Georgia, Mississippi, North Carolina, South Carolina, and Tennessee) have not expanded Medicaid to-date. 

In our study, we identify this policy adoption discrepancy as a "treatment" (i.e., "differential exposure between entities over time") affecting drug overdose incidence in Appalachian communities. Our *hypothesized* causal mechanism is that expanded Medicaid eligibility allowed for greater access to low-cost health care among Appalachian counties in expansion states, therefore enabling people struggling with drug addiction to receive treatment when they otherwise would not have been able to receive care, reducing overall deaths from drug overdose in these areas.

Existing literature has also examined the counter-hypothesis that Medicaid expansion may have actually *increased* drug overdose rates by increasing access to prescription opioids. [Swartz and Beltran (2019)](https://onlinelibrary.wiley.com/doi/epdf/10.1111/add.14741) find that, while Medicaid expansion did increase prescription opioid availability, there was no accompanying increase in overdose mortality. [Venkataramani and Chatterjee (2018)](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6318168/) examine early 2000s Medicaid expansion in Arizona, Maine, and New York, and find that expansion did in fact *decrease* overdose death rates relative to neighboring non-expansion states.

\medspace

# Data Description

```{r load data, include = FALSE}
# Load panel data
year_county_panel <- readRDS("yearly_panel.rds")

# Load county data
appalachian_counties <- readRDS("appalachian_counties.rds")
expansion_count <- as.numeric(table(appalachian_counties$medicaid_expansion))

# Turn panel into panel format, limit to 4 years prior and 5 years after
YC_panel <- panel_data(year_county_panel, id = "COUNTY", wave = "Year") %>% 
  filter(between(t_expansion, -4, 4))
```

Our data is a county-year panel dataset, which we use to examine drug overdose deaths in Appalachian counties over the period 2010-2019. In total, this panel dataset is constituted by `r nrow(year_county_panel)` county-year observations (i.e., `r nrow(appalachian_counties)` counties across nine years). For analysis, however, we restrict the panel to the four years prior to Medicaid expansion and the five years after, resulting in a final dataset of `r nrow(YC_panel)` observations. The discrepancy between these two datasets is due to Pennsylvania's delayed adoption of Medicaid.

The subset of US counties defined as "Appalachian" is based on the jurisdiction of the Appalachian Regional Council ([ARC, 2021](https://www.arc.gov/appalachian-counties-served-by-arc/)). Accordingly, our units of observation for this study are counties, with the representative population being people living in the Appalachian region. 

Identification of state-level Medicaid expansion is based on tracking done by the Kaiser Family Foundation ([KFF, 2022](https://www.kff.org/medicaid/issue-brief/status-of-state-medicaid-expansion-decisions-interactive-map/)). Note that, due to the fact that Pennsylvania implemented Medicaid expansion a year after other expansion states, the timing of "treatment" for Appalachian counties in Pennsylvania is delayed by one year relative to other counties in expansion states. Additionally, we consider Virginia to be a non-expansion state for the purposes of this study, because it only enacted Medicaid expansion in 2019, well after the end of our study period.

Data on drug overdose death rates (i.e., deaths per 100,000 residents) comes from estimates modeled by the National Center for Health Statistics (NCHS), which are available at the county-level for the period 2003-2020. Unfortunately, county-level statistics on overdose deaths based on final counts of cause of death reporting only became available starting in 2020, outside of the time frame of this study.

County-level demographic covariates are taken from the US Census Bureau American Community Survey (ACS). Using these covariates, we hope to control for omitted variable bias stemming from county-level factors such as poverty rates, median age, and sex and race compositions. In particular, we expect that poverty rates would relate positively to overdose deaths, as poverty levels and overdose deaths have been previously linked ([Pear et al, 2019](https://pubmed.ncbi.nlm.nih.gov/30592998/)). We include controls for median age as drug overdose death incidence tends to vary by age group ([KFF, 2022](https://www.kff.org/other/state-indicator/opioid-overdose-deaths-by-age-group/?dataView=1&currentTimeframe=6&selectedDistributions=0-24--25-34--35-44--45-54&sortModel=%7B%22colId%22:%22Location%22,%22sort%22:%22asc%22%7D)). Drug overdose deaths are also more common among individuals identified as male than female ([CDC, 2022](https://www.cdc.gov/nchs/hus/topics/drug-overdose-deaths.htm)). Furthermore, access to drug treatment has been shown to differ according to race ([NIDA, 2019](https://nida.nih.gov/about-nida/noras-blog/2019/07/access-to-addiction-services-differs-by-race-gender)), potentially leading to differentials in drug overdose deaths depending on racial composition of counties.

Given that both the NCHS data on overdose death rates and ACS control variables are estimated at the county-level, we expand our study period to the four years prior to Medicaid expansion and the five years after (i.e., 2010-2019), in order to smooth over any potential estimation errors. We also hope that this larger time frame will capture any lags in treatment effects, given that reductions in drug overdose deaths due to expanded access to health care may not be reflected in the data until more than a year after Medicaid expansion.

From the sources, data is largely already available at the county-level, thus we are not required to perform any aggregation or dis-aggregation steps to make the data suitable for use. Furthermore, variables of interest are entirely quantitative, thus cleaning needs are minimal. All source data include county-specific FIPS codes as merging indices. The only intermediate data transformation we perform is the calculation of county-level racial composition shares and poverty rates, based on Census Bureau population data.

## "High" and "Low Risk" Counties

To further distinguish between our hypothesis that Medicaid expansion has reduced drug overdose deaths in Appalachia and the counter hypothesis that oppositely suggests Medicaid expansion increased drug overdose deaths, within our county-year panel dataset, we analyze "high" and "low risk" county subsets. 



See Appendix II for our methodology in defining "high" and "low risk" counties, as well as a detailed breakdown of the characteristics of each group.

\medspace

# Descriptive Statistics

## Variation in Policy "Treatment"

In total, `r expansion_count[2]` Appalachian counties are located in expansion states and `r expansion_count[1]` Appalachian counties are located in non-expansion states.

We map Appalachian counties by Medicaid expansion status below:

```{r create map, include = FALSE}
appalachian_counties_map <- st_as_sf(appalachian_counties)

expansion_map <- tm_shape(appalachian_counties_map) + 
  tm_polygons("medicaid_expansion",
              title = "Medicaid Expansion Status",
              palette = 'Pastel1') +
  tm_borders()
```

```{r fig1, fig.cap="Map of Medicaid Expansion Status Across Appalachian Counties", fig.width=6, fig.height=4}
expansion_map
```

Note that Virginia did eventually enact Medicaid expansion in 2019, but these observations are not included in our analytical sample (2019 observations are only analyzed for Pennsylvania), and thus Appalachian counties in Virginia are considered to be "non-expansion" in our analysis. Clearly, at the state level there is a degree of "North-South" bias in terms of which states elected to expand Medicaid. However, our empirical strategy (as discussed in the next section) aims to minimize any associated omitted variable bias with county-level fixed effects.

## Variation in Drug Overdose Death Rate

In the figure below, we plot the weighted-average of county-level drug overdose death rate over time (i.e., "Years since Medicaid Expansion"), separating counties in expansion states from counties in non-expansion states. 

```{r create line plot, include = FALSE}
line_plot_panel <- year_county_panel %>% 
    group_by(t_expansion, medicaid_expansion) %>% 
    summarize(estimated_overdose_death_rate = weighted.mean(
    estimated_overdose_death_rate, w = population, na.rm = T), .groups = 'drop') %>% 
    filter(between(t_expansion, -4, 4))

overdose_line_plot <- line_plot_panel %>% 
    ggplot(aes(x = t_expansion,
               y = estimated_overdose_death_rate,
               color = medicaid_expansion)) +
    geom_line() +
    geom_point() +
    geom_vline(aes(xintercept = -1)) +
    scale_color_brewer(palette = "Pastel1", name = "Medicaid Expansion Status") +
    labs(x = "Years since Medicaid Expansion",
         y = "Drug Overdose Deaths per 100,000")
```

\FloatBarrier

```{r fig2, fig.cap = "Yearly County-Level Drug Overdose Death Rates by Medicaid Expansion Status", fig.width=6, fig.height=4}
overdose_line_plot
```

\FloatBarrier

While drug overdose death rates are persistently higher in expansion counties than in non-expansion counties, it appears that expansion counties and non-expansion counties experience near-parallel trends prior to Medicaid expansion. In the first few years following expansion, however, we observe an *steepening trend* of overdose death rates in *expansion counties* relative to *non-expansion counties*, indicating that Medicaid expansion had a *positive* effect on overdose death rates, contradicting the direction of our hypothesized causal effect.

Yet, we also observe that this steepening trend of overdose death rates in expansion counties *declines* following the first two years after Medicaid expansion. Between years three and four after Medicaid expansion, it even appears that parallel trends in overdose deaths have resumed. This suggests that, to the extent Medicaid expansion has increased overdose death rates in expansion counties, this effect was short-lived. 

## Variation in Key Continuous Variables

We also explore the balance across key continuous variables between counties in expansion states and counties in non-expansion states, a year prior to the time when Medicaid expansion occurs.

```{r create diif in means, include = FALSE}
t_expansion_county_panel <- year_county_panel %>% 
  filter(t_expansion == -1) %>% 
  rename(weights = population,
         `Poverty Rate` = poverty_rate,
         `Median Age` = med_age,
         `Male Share` = male_share,
         `Black Share` = black_share,
         `Hispanic Share` = hisp_share,
         `White Share` = white_share,
         `Asian Share` = asian_share) %>%
  select('medicaid_expansion', 'Poverty Rate', 'Median Age', 'Male Share', 'Black Share', 'Hispanic Share', 'White Share', 'Asian Share')

#show diff between treatment and control groups 
diff_in_means_table <- datasummary_balance(~medicaid_expansion,
                    data = t_expansion_county_panel,
                    fmt = 2,
                    dinm_statistic = "p.value",
                    title = "Difference-in-means between Expansion and Non-Expansion Counties, One Year Prior to Medicaid Expansion",
                    notes = "Note: Observations are weighted by the population in each county.",
                    ) %>% 
  kable_styling(latex_options = "HOLD_position")
```

```{r display diff in means, echo = FALSE}
diff_in_means_table
```

Table 1 above shows difference-in-means between "treatment" (i.e., Medicaid expansion) counties and "control" counties in the year of Medicaid expansion. We observe statistically significant differences between "treatment" and "control" groups for male share of population and racial composition (i.e., Black, White, and Hispanic share of population). This suggests that these factors are unbalanced between the two groups of Appalachian counties, which would lead to omitted variable bias if they are not controlled for in our estimation specification.

\medspace

# Empirical Strategy

The primary variation that we seek to exploit through our analysis is the differential in state-level adoption of Medicaid expansion across the Appalachian region, with policy variation at the state-level thus filtering down to the county-level. We do this in two ways:

To establish a single average causal treatment effect estimate over the five years after Medicaid was expanded, we first take a difference-in-differences approach. This approach allows us to simply establish evidence of a causal linkage between Medicaid expansion and drug overdose deaths in Appalachia. We then go a step further by exploring an event study approach, examining year-by-year treatment effects relative to the year prior to Medicaid expansion. This second approach allows us to demonstrate the robustness of our measured treatment effect over time.

Finally, we look for heterogeneous treatment effects between "high" and "low risk" counties in both approaches. 

## Difference-in-Differences

To evaluate the effect of Medicaid expansion on drug overdose deaths in Appalachian counties, we estimate the following "differences-in-differences" specification:

$$ODR_{it} = \beta Expansion_{it} + \textbf{X}_{it} \gamma + \nu_{i} + \tau_{t} + \varepsilon_{it}$$

where $ODR_{it}$ is deaths attributed to drug overdose per 100,000 county residents for county $i$ at time $t$, $Expansion_{it}$ is a binary variable that indicates "treatment" status (i.e., enactment of Medicaid expansion) for a county-year, $\textbf{X}_{it}$ is a vector of time varying controls (e.g., poverty rates, median age, male population share, racial composition) for potential county-level determinants of overdose death rates outside of our policy variation of interest.

Additionally, we include an array of county fixed effects, $\nu_{i}$, that control for unobserved time-invariant factors that are specific to individual counties. An example of one such factor would be if, throughout the entire 2010-2019 period, a specific county had its own drug treatment program that reduced drug overdose deaths compared to other counties, all else equal. We further include $\tau_{t}$, year fixed effects, to control for unobserved county-invariant factors that might have changed between each year included in our panel. Such factors would include events such as periodic economic shocks that affect the entire Appalachian region in certain years, which potentially could be deterministic of the rate of overdose deaths. Finally, $\varepsilon_{it}$ is the idiosyncratic error term.

## Event Study

$$ODR_{it} =  1\{\text{Expansion}_i\} \left [ \sum_{y=-4}^{-2} \beta_y^{pre} 1\{t - t_i^* = y\} + \sum_{y=0}^{4} \beta_y^{post} 1\{t - t_i^* = y\}\right ] + \textbf{X}_{it} \gamma + \nu_{i} + \tau_{t} + \varepsilon_{it}$$
In this approach, $1\{\text{Expansion}_i\}$ is a binary variable identifying high-eligibility states, and $t_i^*$ is the year Medicaid was expanded in county $i$. The $1\{t - t_i^* = y\}$ terms are dummy variables corresponding to an *event year*, i.e., the year relative to the expansion of Medicaid at time $t_i^*$. The coefficients of interest are now $\beta^{pre}_y$ and $\beta^{post}_y$, which measure the relationship between drug overdose death rates and expansion status in each of the four years leading up to Medicaid expansion and five years after. We omit the dummy for the year before Medicaid expansion ($y = -1$), so that the estimates of $\beta^{pre}_y$ and $\beta^{post}_y$ capture effects relative to just before Medicaid expansion. 

In particular, we measure the $\beta^{pre}_y$ parameters to capture the relationship between expansion status and overdose death rates before Medicaid was expanded, in order to establish the assumption of parallel trends; statistically significant estimates during the pre-treatment period would be inconsistent with the parallel trends assumption, as this would indicate that expansion counties already faced a different trajectory of overdose death rates prior to the expansion of Medicaid. The $\beta^{post}_y$ parameters represent the causal effect of Medicaid expansion for each event year ($y$).

Finally, we include the same vector of time-varying controls ($\textbf{X}_{it}$), county fixed-effects ($\nu_{i}$), and year fixed-effects ($\tau_{t}$), as specified in the differences-in-differences approach.

\medspace

# Findings

## Difference-in-Difference Results

We estimate difference-in-differences effects for all counties, "high risk," and "low risk" counties. 

```{r estimate DID models, include = FALSE}
risk_levels <- readRDS("risk_levels.rds")

# Merge risk levels with counties

YC_panel <- YC_panel %>% 
  left_join(risk_levels, by = "FIPS")

high_risk_panel <- YC_panel %>% 
  filter(risk == "High")

low_risk_panel <- YC_panel %>% 
  filter(risk == "Low")

did_models <- list(
  "All Counties" <- feols(estimated_overdose_death_rate ~ 
                                         treat + poverty_rate + med_age + male_pop + black_pop + hisp_pop + asian_pop | COUNTY + Year, 
                data = YC_panel,
                weights = YC_panel$population,
                cluster = YC_panel$COUNTY),
  
  "High Risk" <- feols(estimated_overdose_death_rate ~ 
                                         treat + poverty_rate + med_age + male_pop + black_pop + hisp_pop + asian_pop | COUNTY + Year, 
                data = high_risk_panel,
                weights = high_risk_panel$population,
                cluster = high_risk_panel$COUNTY),
  
  "Low Risk" <- feols(estimated_overdose_death_rate ~ 
                                         treat + poverty_rate + med_age + male_pop + black_pop + hisp_pop + asian_pop | COUNTY + Year, 
                data = low_risk_panel,
                weights = low_risk_panel$population,
                cluster = low_risk_panel$COUNTY)
)

names(did_models) <- c("All Counties", "High Risk", "Low Risk")

#set up an object to customize your regression table goodness-of-fit statistics
gm <- tibble::tribble(
    ~raw,        ~clean,          ~fmt,
    "nobs",               "N",                  0,
    "r.squared",          "R-squared",      3,
    "adj.r.squared",      "Adj. R-squared", 3,
    "FE: COUNTY",         "County FEs",          0,
    "FE: Year",    "Year FEs",    0
    )

#display results with added formatting options    
did_estimation_results <- modelsummary(did_models,
             fmt = "%.4f",
             coef_omit = 'Intercept',
             coef_rename = c("treat" = "Medicaid Expansion", 
                             "poverty_rate" = "Poverty Rate (0-100)",
                             "med_age" = "Median Age",
                             "male_pop" = "Male Population Share (0-100)",
                             "black_pop" = "Black Population Share",
                             "hisp_pop" = "Hispanic Population Share",
                             "asian_pop" = "Asian Population Share"),
             gof_map = gm,
             title = 'Effect of Medicaid Expansion on Drug Overdose Death Rates',
             stars = c('*' = .1, '**' = .05, '***' = .01),
             notes = 'Robust standard errors clustered by county are shown in parentheses.
                      Observations are weighted by the population in each county.') %>% 
  kable_styling(latex_options = c("hold_position", "scale_down"))

```

```{r display DID estimates, echo = FALSE}
did_estimation_results
```

Table 2 displays difference-in-difference estimation results

## Event Study Results

```{r estimate event study model, include = FALSE}
ES_mod <- feols(
  estimated_overdose_death_rate ~ i(factor(t_expansion), as.numeric(medicaid_expansion), ref = -1) 
  + poverty_rate + med_age + male_pop + black_pop + hisp_pop + asian_pop
  | COUNTY + Year,
  data = YC_panel, 
  weight = YC_panel$population,
  cluster = YC_panel$COUNTY)
```

```{r fig3, fig.cap = "Medicaid Expansion's Effect on Drug Overdose Death Rates in All Appalachian Counties", fig.width=6, fig.height=4}
iplot(
  ES_mod,
  pt.join = TRUE,
  ci.join = TRUE,
  ci.lwd = 0,
  grid.par = list(vert = FALSE),
  main = "",
  ylab = "Est. Effect on Overdose Death Rates",
  xlab = "Years since Medicaid Expansion")
```

Figure 3 displays the yearly estimated effect of Medicaid expansion on drug overdose death rates in Appalachia, before and after expansion occurs. 

\medspace

# Conclusion

Our estimates provide significant evidence for the conclusion that Medicaid expansion in Appalachian states had the unintended consequence of ***increasing*** deaths from drug overdose. A possible mechanism for this result is increased access to prescription opioids.

Our findings differ from previous studies on the effect of Medicaid expansion on overdose deaths. However, one of these studies [Swartz and Beltran (2019)](https://onlinelibrary.wiley.com/doi/epdf/10.1111/add.14741), did find that expansion increased the supply of prescription opioids and that there could be a lagged increase in overdose deaths. Our event study approach does show evidence to support a theory of lagged effects, as causal estimates are largest two-to-five years after Medicaid expansion.

Key limitations include potential OVB due to county-year variation in number of Substance Use Disorder (SUD) treatment facilities and lack of external validity outside of Appalachia. The latter limitation could explain why our results differ from previous studies.

\medspace

# Appendices

## Appendix I: Data Sources

We compile publicly-available data from the Appalachian Regional Council (ARC), Kaiser Family Foundation (KFF), National Center for Health Statistics (NCHS), and the US Census Bureau into a single county-year panel data set.

### Appalachian Counties Data

The Appalachian Regional Commission defines 423 counties in 13 states (West Virginia, Alabama, Georgia, Kentucky, Maryland, Mississippi, New York, North Carolina, Ohio, Pennsylvania, South Carolina, Tennessee, and Virginia) as demarcating the Appalachian region. We adopt this geographical definition in our research approach.

More information available at: https://www.arc.gov/appalachian-counties-served-by-arc/.

```{r load county data}
appalachian_counties <- read_excel('data/appalachian_counties_ARC_2021.xlsx')
```

### Medicaid Expansion

Of the 13 states, five states (Kentucky, Maryland, New York, Ohio, and West Virginia) passed legislation mandating the expansion of Medicaid as of January 1st, 2014. Two additional states, Pennsylvania and Virginia, would later expand Medicaid, with the former in 2015 and the latter in 2019. Six states (Alabama, Georgia, Mississippi, North Carolina, South Carolina, and Tennessee) have not expanded Medicaid to-date.

We add a dummy variable into our data to reflect this policy difference. Information on state-level Medicaid expansion available at: https://www.kff.org/medicaid/issue-brief/status-of-state-medicaid-expansion-decisions-interactive-map/.

```{r code policy variables}
# Create dummy variable for medicaid expansion and a variable for date of expansion

expansion <- c("Kentucky", "Maryland", "New York", "Ohio", "West Virginia",
                     "Pennsylvania")
no_expansion <- c("Alabama", "Georgia", "Mississippi", "North Carolina", 
                  "South Carolina", "Tennessee", "Virginia")

appalachian_counties <- appalachian_counties %>% 
  mutate(medicaid_expansion = as.numeric(STATE %in% expansion),
         expansion_date = make_date(2014, 1, 1))

# Re-code dates for Pennsylvania (late expansion)

appalachian_counties$expansion_date[appalachian_counties$STATE == "Pennsylvania"] <-
  make_date(2015,1,1)

# Re-code medicaid expansion as a factor

appalachian_counties$medicaid_expansion <- factor(appalachian_counties$medicaid_expansion,
                                    levels = c(0,1),
                                    labels = c("Non-Expansion", "Expansion"))
```

### Geographic Boundaries

In addition to county-level demographics, we pull county shapefiles from the Census Bureau for mapping visuals: https://www.census.gov/geographies/mapping-files/time-series/geo/cartographic-boundary.html

```{r shape file}
county_shapes <- read_sf(dsn = 'data/cb_2021_us_county_5m/cb_2021_us_county_5m.shp')

county_shapes <- county_shapes %>% 
  mutate(FIPS = GEOID)

appalachian_counties <- appalachian_counties %>% 
  left_join(county_shapes, by = 'FIPS') %>% 
  select(FIPS, STATE, COUNTY, medicaid_expansion, expansion_date, geometry)
```

### Overdose Deaths

Our data on drug overdose deaths comes from estimates modeled by the National Center for Health Statistics (NCHS), which are available at the county-level for the period 2003-2020. Source link: https://www.cdc.gov/nchs/data-visualization/drug-poisoning-mortality/.

```{r load overdose data}
overdose_data <- read_csv("data/NCHS_-_Drug_Poisoning_Mortality_by_County__United_States.csv")

# Keep columns for FIPS codes, year, and modeled overdose deaths

overdose_data <- overdose_data %>% 
  select(FIPS, Year, `Model-based Death Rate`) %>%
  rename(estimated_overdose_death_rate = `Model-based Death Rate`)
```

### County-Level Demographics

To control for time-variant, county-variant factors, we pull demographic data from the US Census Bureau's American Community Survey (ACS), for years 2010-2019. Data is downloaded from the US Census Bureau API using the R package tidycensus.

```{r load ACS data}
census_api_key("b79b301dc87bb0fd551147883a8141dca4e2823e")

# Pull 2010 ACS county-level data 

acs_2010 <- get_acs(geography = "county",
                   variables = c(population = "B01001_001",
                                 white_pop = "B01001H_001",
                                 hisp_pop = "B01001I_001",
                                 asian_pop = "B02001_005",
                                 black_pop = "B02001_003",
                                 male_pop = "B01001_002",
                                 med_income = "B19013_001",
                                 med_age = "B01002_001",
                                 pov = "B17025_002"),
                   year = 2010)

acs_2010 <- acs_2010 %>% 
  select(-moe, -NAME) %>% 
  spread(key = variable, value = estimate) %>% 
  mutate(Year = 2010,
         white_share = 100 * (white_pop/population),
         hisp_share = 100 * (hisp_pop/population),
         asian_share = 100 * (asian_pop/population),
         black_share = 100 * (black_pop/population),
         male_share = 100 * (male_pop/population),
         poverty_rate = 100 * (pov/population))


# Pull 2011 ACS county-level data 

acs_2011 <- get_acs(geography = "county",
                   variables = c(population = "B01001_001",
                                 white_pop = "B01001H_001",
                                 hisp_pop = "B01001I_001",
                                 asian_pop = "B02001_005",
                                 black_pop = "B02001_003",
                                 male_pop = "B01001_002",
                                 med_income = "B19013_001",
                                 med_age = "B01002_001",
                                 pov = "B17025_002"),
                   year = 2011)

acs_2011 <- acs_2011 %>% 
  select(-moe, -NAME) %>% 
  spread(key = variable, value = estimate) %>% 
  mutate(Year = 2011,
         white_share = 100 * (white_pop/population),
         hisp_share = 100 * (hisp_pop/population),
         asian_share = 100 * (asian_pop/population),
         black_share = 100 * (black_pop/population),
         male_share = 100 * (male_pop/population),
         poverty_rate = 100 * (pov/population))


# Pull 2012 ACS county-level data 

acs_2012 <- get_acs(geography = "county",
                   variables = c(population = "B01001_001",
                                 white_pop = "B01001H_001",
                                 hisp_pop = "B01001I_001",
                                 asian_pop = "B02001_005",
                                 black_pop = "B02001_003",
                                 male_pop = "B01001_002",
                                 med_income = "B19013_001",
                                 med_age = "B01002_001",
                                 pov = "B17025_002"),
                   year = 2012)

acs_2012 <- acs_2012 %>% 
  select(-moe, -NAME) %>% 
  spread(key = variable, value = estimate) %>% 
  mutate(Year = 2012,
         white_share = 100 * (white_pop/population),
         hisp_share = 100 * (hisp_pop/population),
         asian_share = 100 * (asian_pop/population),
         black_share = 100 * (black_pop/population),
         male_share = 100 * (male_pop/population),
         poverty_rate = 100 * (pov/population))

# Pull 2013 ACS county-level data 

acs_2013 <- get_acs(geography = "county",
                   variables = c(population = "B01001_001",
                                 white_pop = "B01001H_001",
                                 hisp_pop = "B01001I_001",
                                 asian_pop = "B02001_005",
                                 black_pop = "B02001_003",
                                 male_pop = "B01001_002",
                                 med_income = "B19013_001",
                                 med_age = "B01002_001",
                                 pov = "B17025_002"),
                   year = 2013)

acs_2013 <- acs_2013 %>% 
  select(-moe, -NAME) %>% 
  spread(key = variable, value = estimate) %>% 
  mutate(Year = 2013,
         white_share = 100 * (white_pop/population),
         hisp_share = 100 * (hisp_pop/population),
         asian_share = 100 * (asian_pop/population),
         black_share = 100 * (black_pop/population),
         male_share = 100 * (male_pop/population),
         poverty_rate = 100 * (pov/population))

# Pull 2014 ACS county-level data 

acs_2014 <- get_acs(geography = "county",
                   variables = c(population = "B01001_001",
                                 white_pop = "B01001H_001",
                                 hisp_pop = "B01001I_001",
                                 asian_pop = "B02001_005",
                                 black_pop = "B02001_003",
                                 male_pop = "B01001_002",
                                 med_income = "B19013_001",
                                 med_age = "B01002_001",
                                 pov = "B17025_002"),
                   year = 2014)

acs_2014 <- acs_2014 %>% 
  select(-moe, -NAME) %>% 
  spread(key = variable, value = estimate) %>% 
  mutate(Year = 2014,
         white_share = 100 * (white_pop/population),
         hisp_share = 100 * (hisp_pop/population),
         asian_share = 100 * (asian_pop/population),
         black_share = 100 * (black_pop/population),
         male_share = 100 * (male_pop/population),
         poverty_rate = 100 * (pov/population))

# Pull 2015 ACS county-level data 

acs_2015 <- get_acs(geography = "county",
                   variables = c(population = "B01001_001",
                                 white_pop = "B01001H_001",
                                 hisp_pop = "B01001I_001",
                                 asian_pop = "B02001_005",
                                 black_pop = "B02001_003",
                                 male_pop = "B01001_002",
                                 med_income = "B19013_001",
                                 med_age = "B01002_001",
                                 pov = "B17025_002"),
                   year = 2015)

acs_2015 <- acs_2015 %>% 
  select(-moe, -NAME) %>% 
  spread(key = variable, value = estimate) %>% 
  mutate(Year = 2015,
         white_share = 100 * (white_pop/population),
         hisp_share = 100 * (hisp_pop/population),
         asian_share = 100 * (asian_pop/population),
         black_share = 100 * (black_pop/population),
         male_share = 100 * (male_pop/population),
         poverty_rate = 100 * (pov/population))

# Pull 2016 ACS county-level data 

acs_2016 <- get_acs(geography = "county",
                   variables = c(population = "B01001_001",
                                 white_pop = "B01001H_001",
                                 hisp_pop = "B01001I_001",
                                 asian_pop = "B02001_005",
                                 black_pop = "B02001_003",
                                 male_pop = "B01001_002",
                                 med_income = "B19013_001",
                                 med_age = "B01002_001",
                                 pov = "B17025_002"),
                   year = 2016)

acs_2016 <- acs_2016 %>% 
  select(-moe, -NAME) %>% 
  spread(key = variable, value = estimate) %>% 
  mutate(Year = 2016,
         white_share = 100 * (white_pop/population),
         hisp_share = 100 * (hisp_pop/population),
         asian_share = 100 * (asian_pop/population),
         black_share = 100 * (black_pop/population),
         male_share = 100 * (male_pop/population),
         poverty_rate = 100 * (pov/population))

# Pull 2017 ACS county-level data 

acs_2017 <- get_acs(geography = "county",
                   variables = c(population = "B01001_001",
                                 white_pop = "B01001H_001",
                                 hisp_pop = "B01001I_001",
                                 asian_pop = "B02001_005",
                                 black_pop = "B02001_003",
                                 male_pop = "B01001_002",
                                 med_income = "B19013_001",
                                 med_age = "B01002_001",
                                 pov = "B17025_002"),
                   year = 2017)

acs_2017 <- acs_2017 %>% 
  select(-moe, -NAME) %>% 
  spread(key = variable, value = estimate) %>% 
  mutate(Year = 2017,
         white_share = 100 * (white_pop/population),
         hisp_share = 100 * (hisp_pop/population),
         asian_share = 100 * (asian_pop/population),
         black_share = 100 * (black_pop/population),
         male_share = 100 * (male_pop/population),
         poverty_rate = 100 * (pov/population))

# Pull 2018 ACS county-level data 

acs_2018 <- get_acs(geography = "county",
                   variables = c(population = "B01001_001",
                                 white_pop = "B01001H_001",
                                 hisp_pop = "B01001I_001",
                                 asian_pop = "B02001_005",
                                 black_pop = "B02001_003",
                                 male_pop = "B01001_002",
                                 med_income = "B19013_001",
                                 med_age = "B01002_001",
                                 pov = "B17025_002"),
                   year = 2018)

acs_2018 <- acs_2018 %>% 
  select(-moe, -NAME) %>% 
  spread(key = variable, value = estimate) %>% 
  mutate(Year = 2018,
         white_share = 100 * (white_pop/population),
         hisp_share = 100 * (hisp_pop/population),
         asian_share = 100 * (asian_pop/population),
         black_share = 100 * (black_pop/population),
         male_share = 100 * (male_pop/population),
         poverty_rate = 100 * (pov/population))

# Pull 2019 ACS county-level data 

acs_2019 <- get_acs(geography = "county",
                   variables = c(population = "B01001_001",
                                 white_pop = "B01001H_001",
                                 hisp_pop = "B01001I_001",
                                 asian_pop = "B02001_005",
                                 black_pop = "B02001_003",
                                 male_pop = "B01001_002",
                                 med_income = "B19013_001",
                                 med_age = "B01002_001",
                                 pov = "B17025_002"),
                   year = 2019)

acs_2019 <- acs_2019 %>% 
  select(-moe, -NAME) %>% 
  spread(key = variable, value = estimate) %>% 
  mutate(Year = 2019,
         white_share = 100 * (white_pop/population),
         hisp_share = 100 * (hisp_pop/population),
         asian_share = 100 * (asian_pop/population),
         black_share = 100 * (black_pop/population),
         male_share = 100 * (male_pop/population),
         poverty_rate = 100 * (pov/population))

# Append into single ACS data frame, rename GEOID as FIPS

acs_10_to_19 <- rbind(acs_2010, acs_2011, acs_2012, acs_2013, acs_2014, acs_2015, acs_2016, acs_2017, acs_2018, acs_2019)
acs_10_to_19 <- acs_10_to_19 %>% 
  mutate(GEOID = as.numeric(GEOID)) %>% 
  rename(FIPS = GEOID)
```

## Merge Data into Consolidated Data Set

We merge the Appalachian counties data, overdose data, and ACS data into a single data set. We save the resulting panel dataframe and county-level dataframe as .rds files, so that they can be loaded at the beginning of this file and elsewhere.

```{r merge data}

# Create four versions of the Appalachian counties data, one for each year in our study, 
# merge with other data, then append into a panel

appalachian_counties_10 <- appalachian_counties %>% 
  mutate(Year = 2010)
appalachian_counties_11 <- appalachian_counties %>% 
  mutate(Year = 2011)
appalachian_counties_12 <- appalachian_counties %>% 
  mutate(Year = 2012)
appalachian_counties_13 <- appalachian_counties %>% 
  mutate(Year = 2013)
appalachian_counties_14 <- appalachian_counties %>% 
  mutate(Year = 2014)
appalachian_counties_15 <- appalachian_counties %>% 
  mutate(Year = 2015)
appalachian_counties_16 <- appalachian_counties %>% 
  mutate(Year = 2016)
appalachian_counties_17 <- appalachian_counties %>% 
  mutate(Year = 2017)
appalachian_counties_18 <- appalachian_counties %>% 
  mutate(Year = 2018)
appalachian_counties_19 <- appalachian_counties %>% 
  mutate(Year = 2019)

appalachian_counties_panel <- rbind(appalachian_counties_10,
                                    appalachian_counties_11,
                                    appalachian_counties_12,
                                    appalachian_counties_13,
                                    appalachian_counties_14,
                                    appalachian_counties_15,
                                    appalachian_counties_16,
                                    appalachian_counties_17,
                                    appalachian_counties_18,
                                    appalachian_counties_19)

# Create variable for time since expansion and treatment variable

appalachian_counties_panel <- appalachian_counties_panel %>% 
  mutate(t_expansion = Year - year(expansion_date),
        treat = ifelse(t_expansion >= 0, medicaid_expansion, 0))

# Merge panel with overdose data

appalachian_counties_overdose_panel <- appalachian_counties_panel %>% 
  mutate(FIPS = as.numeric(FIPS)) %>% 
  left_join(overdose_data, by = c("FIPS", "Year"))

# Merge panel with ACS data (save as an RDS file)

yearly_counties_panel_overdose_acs <- appalachian_counties_overdose_panel %>% 
  left_join(acs_10_to_19, by = c("FIPS", "Year"))

# Save panel and county datasets as .rds files

saveRDS(yearly_counties_panel_overdose_acs, file = "yearly_panel.rds")
saveRDS(appalachian_counties, file = "appalachian_counties.rds")
```

## Appendix II: Defining "High" and "Low Risk" Counties

```{r pre treatment data, include = FALSE}
# Load panel data
year_county_panel <- readRDS("yearly_panel.rds")

# Limit dataset to pre-expansion and select necessary variables, reshape to wide, calculate CAGR
pre_expansion_panel <- year_county_panel %>% 
  filter(between(t_expansion, -4, -1)) %>% 
  select("FIPS", "t_expansion", "estimated_overdose_death_rate", "geometry", "medicaid_expansion") %>% 
  spread(key = t_expansion, value = estimated_overdose_death_rate) %>% 
  mutate(pre_expansion_CAGR = (((`-1`/`-4`)^(1/3)) - 1) * 100) 
```

To define "high" and "low risk" counties, we examine the trajectory of drug overdose death rates in Appalachian counties prior to Medicaid expansion. In particular, we calculate the compound annual growth rates (CAGR) of overdose death rates in Appalachian counties in the pre-expansion period (i.e., between one and four years prior to expansion). Shown in the figure below, CAGR of overdose death rates varies considerably across Appalachian counties during this period, with some counties experiencing a drastic reduction in overdose death rates, while others see massive increases.

```{r create CAGR map}
pre_expansion_map <- st_as_sf(pre_expansion_panel)

CAGR_map <- tm_shape(pre_expansion_map) + 
  tm_polygons("pre_expansion_CAGR",
              title = "CAGR of Overdose Death Rates",
              palette = 'PuRd') +
  tm_borders()
```

```{r fig6, fig.cap="Map of Pre-Expansion CAGR of Overdose Death Rates Across Appalachian Counties", fig.width=6, fig.height=4}
CAGR_map
```

```{r five num sum, include = FALSE}
five_num_CAGR <- fivenum(pre_expansion_panel$pre_expansion_CAGR)
```

Over this period, CAGR of overdose death rates ranged from `r round(five_num_CAGR[1], 2)`% to `r round(five_num_CAGR[5], 2)`%, with a median of `r round(five_num_CAGR[3], 2)`%. We define "high risk" counties as counties with a pre-expansion CAGR of drug overdose death rates above the 75th percentile (i.e., `r round(five_num_CAGR[4], 2)`%), and similarly define "low risk" counties as counties with a pre-expansion CAGR of drug overdose death rates below the 25th percentile (i.e., `r round(five_num_CAGR[2], 2)`%). Qualitatively, "high risk" counties can be thought of as Appalachian counties that were already experiencing substantial increases in drug overdose death rates prior to the expansion of Medicaid. Conversely, "low risk" counties are counties where overdose death rates were either stagnant or declining. Counties in between the 25th and 75th percentiles of pre-expansion CAGR of drug overdose rates are simply defined as "moderate risk."

```{r set risk levels, include = FALSE}
pre_expansion_panel <- pre_expansion_panel %>% 
  mutate(risk = if_else(pre_expansion_CAGR > five_num_CAGR[4], "High", if_else(pre_expansion_CAGR < five_num_CAGR[2], "Low", "Moderate"))) %>% 
  select("FIPS", "geometry", "pre_expansion_CAGR", "risk", "medicaid_expansion")

expansion_risk_count <- table(pre_expansion_panel$medicaid_expansion, pre_expansion_panel$risk)
```

From Table 3 below, it is evident that "high risk" counties are more concentrated among expansion counties, while "low risk" counties are more concentrated among non-expansion counties. Notable, however, is the fact that across Appalachian counties and regardless of expansion status, most counties are low-to-moderate risk, which would indicate that the crisis of rising drug overdose death rates was relatively confined to specific areas in the pre-expansion period. 

```{r twoway risk expansion, echo = FALSE}
expansion_risk_count %>% 
  kable(align = "c",
                  caption = "Two-Way Table of County Expansion and Risk Status")
```

We also explore demographic differences between "high" and "low risk" counties, one year prior to Medicaid expansion.

```{r diff_in_means_2, include = FALSE}
risk_levels <- pre_expansion_panel %>% 
  select("FIPS", "pre_expansion_CAGR", "risk")

#Save risk levels for future use
saveRDS(risk_levels, file = "risk_levels.rds")

t_risk_expansion_county_panel <- year_county_panel %>% 
  filter(t_expansion == -1) %>% 
  left_join(risk_levels, by = "FIPS") %>% 
  filter(risk != "Moderate") %>% 
  rename(weights = population,
         `Poverty Rate` = poverty_rate,
         `Median Age` = med_age,
         `Male Share` = male_share,
         `Black Share` = black_share,
         `Hispanic Share` = hisp_share,
         `White Share` = white_share,
         `Asian Share` = asian_share) %>%
  select('risk', 'Poverty Rate', 'Median Age', 'Male Share', 'Black Share', 'Hispanic Share', 'White Share', 'Asian Share')

#show diff between treatment and control groups 
diff_in_means_table_2 <- datasummary_balance(~risk,
                    data = t_risk_expansion_county_panel,
                    fmt = 2,
                    dinm_statistic = "p.value",
                    title = "Difference-in-means between High and Low Risk Counties, One Year Prior to Medicaid Expansion",
                    notes = "Note: Observations are weighted by the population in each county.",
                    ) %>% 
  kable_styling(latex_options = "HOLD_position")
  
```

```{r disp diff_in_means2, echo = FALSE}
diff_in_means_table_2
```

From Table 4 above, we make the somewhat odd observation that "high risk" counties are poorer and older than "low risk" counties. This would seem to run contrary to the established findings that poverty and youth are factors that tend to *increase* incidence of drug overdose deaths. However, it could just be the case that these factors only affect the *level* of drug overdose death rates in a particular county, but do not play a role in *rates of growth*. In terms of male population share and racial composition, however, there are no statistically significant differences.




