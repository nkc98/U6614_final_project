---
title: "Did Medicaid Expansion Affect Drug Overdose Deaths in Appalachia?"
author: "Neil Chin (nkc2124) & Nicole Yahui Wu (yw3551)"
date: "`r Sys.Date()`"
output:
  ioslides_presentation: default
  beamer_presentation: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

library(tidyverse) 
library(tidycensus)
library(readxl)
library(lubridate)
library(kableExtra)
library(sf)
library(tmap)
library(panelr)
library(fixest)
library(modelsummary)
```

```{css, echo = FALSE}
table, td, th {
  border: none;
  padding-left: 1em;
  padding-right: 1em;
  margin-left: auto;
  margin-right: auto;
  margin-top: 1em;
  margin-bottom: 1em;
}
```

```{r load date, include = FALSE}
# Load panel data
year_county_panel <- readRDS("yearly_panel.rds")

# Load county data
appalachian_counties <- readRDS("appalachian_counties.rds")
expansion_count <- as.numeric(table(appalachian_counties$medicaid_expansion))

# Turn panel into panel format, limit to 3 years prior and 5 years after
YC_panel <- panel_data(year_county_panel, id = "COUNTY", wave = "Year") %>% 
  filter(between(t_expansion, -3, 4))
```

## Research Motivations {.smaller .build}
<div>
* Deaths due to drug overdose are a pressing problem facing United States policymakers and society at large, with reportedly more than 932,000 people dying due to overdose since 1999 ([CDC, 2022](https://www.cdc.gov/drugoverdose/deaths/index.html)).
<div>
* Rates of overdose deaths increased in nearly every US state from 2013-2017, with particularly severe incidence in the Appalachian region ([CDC, 2020](https://www.cdc.gov/drugoverdose/deaths/2013-2017-increase.html); [CDC, 2021](https://www.cdc.gov/drugoverdose/deaths/2014.html)). 
<div>
* The increase in deaths is driven primarily by the ongoing US opioid crisis, with the vast majority (>80%) of overdose deaths associated with opioid use ([CDC, 2022](https://www.cdc.gov/drugoverdose/deaths/index.html)).
<div>
* **In this context, we aim to assess whether expansion of the social safety net through government policy can be causally linked to reductions in drug overdose death rates.**

## Policy Background {.smaller .build}
<div>
* The Affordable Care Act (ACA) was passed by the United States Congress and signed into law by President Barack Obama in 2010, drastically changing the policy landscape for health care in the United States. 
<div>
* **Among the major provisions in the ACA was expanded eligibility for Medicaid (i.e., "Medicaid Expansion"), which allowed states the option to raise the income-eligibility threshold to 138% of the federal poverty level ([KFF, 2022](https://www.kff.org/medicaid/issue-brief/status-of-state-medicaid-expansion-decisions-interactive-map/)).** 
<div>
* Of the **13 states** whose boundaries overlap with the broad geographical definition of Appalachia, **five states** (Kentucky, Maryland, New York, Ohio, and West Virginia) passed legislation mandating the expansion of Medicaid as of January 1st, 2014 ([KFF, 2022](https://www.kff.org/medicaid/issue-brief/status-of-state-medicaid-expansion-decisions-interactive-map/)). **Two additional states**, Pennsylvania and Virginia, would later expand Medicaid, with the former in 2015 and the latter in 2019. 
<div>
* **Six states** (Alabama, Georgia, Mississippi, North Carolina, South Carolina, and Tennessee) have not expanded Medicaid to-date. 

## Policy Background {.smaller .build}

* In total, `r expansion_count[2]` Appalachian counties are located in expansion states and `r expansion_count[1]` Appalachian counties are located in non-expansion states.

```{r create map, include = FALSE}

# Shape file pulled from the Census Bureau: https://www.census.gov/geographies/mapping-files/time-series/geo/cartographic-boundary.html
county_shapes <- read_sf(dsn = 'data/cb_2021_us_county_5m/cb_2021_us_county_5m.shp')

county_shapes <- county_shapes %>% 
  mutate(FIPS = GEOID)

appalachian_counties_map <- appalachian_counties %>% 
  left_join(county_shapes, by = 'FIPS') %>% 
  select(FIPS, geometry, medicaid_expansion)

appalachian_counties_map$medicaid_expansion <- factor(appalachian_counties_map$medicaid_expansion,
                                    levels = c(0,1),
                                    labels = c("Non-Expansion", "Expansion"))

appalachian_counties_map <- st_as_sf(appalachian_counties_map)

expansion_map <- tm_shape(appalachian_counties_map) + 
  tm_polygons("medicaid_expansion",
              title = "Medicaid Expansion Status",
              palette = 'Pastel1') +
  tm_borders()
```

```{r display map, echo = FALSE}
expansion_map
```

## Research Hypothesis {.smaller .build}
<div>
* In our study, we identify the discrepancy in Medicaid expansion as a policy "treatment" (i.e., "differential exposure between entities over time") affecting drug overdose incidence in Appalachian communities. 
<div>
* Our ***hypothesized*** causal mechanism is that expanded Medicaid eligibility allowed for greater access to low-cost health care among Appalachian counties in expansion states, therefore enabling people struggling with drug addiction to receive treatment, ***reducing*** overall deaths from drug overdose in these areas.
<div>
* Existing literature has also examined the counter-hypothesis that Medicaid expansion may have actually ***increased*** drug overdose rates by increasing access to prescription opioids. [Swartz and Beltran (2019)](https://onlinelibrary.wiley.com/doi/epdf/10.1111/add.14741) find that, while Medicaid expansion did increase prescription opioid availability, there was no accompanying increase in overdose mortality. [Venkataramani and Chatterjee (2018)](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6318168/) examine early 2000s Medicaid expansion in Arizona, Maine, and New York, and find that expansion did in fact ***decrease*** overdose death rates relative to neighboring non-expansion states.

## Data Description {.smaller .build}
<div>
* Our data is a county-year panel dataset, comprised of Appalachian counties over the period 2011-2019. For analysis, we restrict the panel to the three years prior to Medicaid expansion and the five years after, resulting in a final dataset of `r nrow(YC_panel)` observations.
<div>
* Data on drug overdose death rates (i.e., deaths per 100,000 residents) comes from estimates modeled by the National Center for Health Statistics (NCHS), which are available at the county-level for the period 2003-2020.
<div>
* County-level demographic covariates are taken from the US Census Bureau American Community Survey (ACS).
<div>
```{r, echo = FALSE}
panel_head <- YC_panel %>% 
  select(COUNTY, Year, FIPS, STATE, medicaid_expansion, expansion_date, treat)
  
kable(panel_head[1:4,], "simple")
```


## Data Description {.smaller .build}

* Exploring the balance across key continuous variables between counties in expansion states and counties in non-expansion states at the time when Medicaid expansion occurs (i.e., Jan. 1st, 2014 for all states expect PA, Jan 1st, 2015 for PA), we find that observable characteristics of the expansion and non-expansion counties are broadly similar.
<div>
```{r create diif in means, include = FALSE}
t_expansion_county_panel <- year_county_panel %>% 
  filter(t_expansion == 0) %>% 
  rename(weights = population,
         `Median Income ($)` = med_income,
         `Median Age` = med_age,
         `Male Share` = male_share,
         `Black Share` = black_share,
         `Hispanic Share` = hisp_share,
         `White Share` = white_share,
         `Asian Share` = asian_share) %>%
  select('medicaid_expansion', 'Median Income ($)', 'Median Age', 'Male Share', 'Black Share', 'Hispanic Share', 'White Share', 'Asian Share')

#show diff between treatment and control groups 
diff_in_means_table <- datasummary_balance(~medicaid_expansion,
                    data = t_expansion_county_panel,
                    fmt = 2,
                    dinm_statistic = "p.value",
                    title = "Difference-in-means during year of Medicaid expansion by county expansion status",
                    notes = "Note: Observations are weighted by the population in each county.",
                    ) %>% 
  kable_styling(latex_options = "scale_down")
```

```{r display diff in means, echo = FALSE}
diff_in_means_table
```

## Exploratory Analaysis {.smaller .build}

Examining overdose death rates over time for expansion and non-expansion counties in Appalachia, it appears that Medicaid expansion had a ***positive*** effect on overdose death rates, contradicting the direction of our hypothesized causal effect.

```{r create line plot, include = FALSE}
# Overdose line plot

line_plot_panel <- year_county_panel %>% 
    group_by(t_expansion, medicaid_expansion) %>% 
    summarize(estimated_overdose_death_rate = weighted.mean(
    estimated_overdose_death_rate, w = population, na.rm = T), .groups = 'drop') %>% 
    filter(between(t_expansion, -3, 4))

overdose_line_plot <- line_plot_panel %>% 
    ggplot(aes(x = t_expansion,
               y = estimated_overdose_death_rate,
               color = medicaid_expansion)) +
    geom_line() +
    geom_point() +
    geom_vline(aes(xintercept = -1)) +
    scale_color_brewer(palette = "Pastel1", name = "Medicaid Expansion Status") +
    labs(x = "Years since Medicaid Expansion",
         y = "Drug Overdose Deaths per 100,000",
         title = "County-Level Drug Overdose Death Rates by Medicaid Expansion Status")
```

```{r display line plot, echo = FALSE}
overdose_line_plot
```

## Empirical Strategy {.smaller .build}

To evaluate the effect of Medicaid expansion on drug overdose deaths in Appalachian counties, we estimate the following "differences-in-differences" specification:

$$Overdose~Death~Rate_{it} = \beta Medicaid~Expansion_{it} + \textbf{X}_{it} \gamma + \nu_{i} + \tau_{t} + \varepsilon_{it}$$

where $Overdose~Death~Rate_{it}$ is deaths attributed to drug overdose per 100,000 county residents for county $i$ at time $t$, $Medicaid~Expansion_{it}$ indicates "treatment" status (i.e., enactment of Medicaid expansion) for a county-year, $\textbf{X}_{it}$ is a vector of time varying controls (e.g., median income, median age, male population share, racial composition) for potential county-level determinants of overdose death rates outside of our policy variation of interest.

Additionally, we include an array of county fixed effects, $\nu_{i}$, that control for unobserved time-invariant factors specific to individual counties. We further include $\tau_{t}$, year fixed effects, to control for unobserved county-invariant factors that might have changed between each year included in our panel. Finally, $\varepsilon_{it}$ is the idiosyncratic error term.

## Estimation Results {.smaller}

We test two model specifications to estimate difference-in-difference effects. The first considers effects up to two years following Medicaid expansion, while the second considers effects up to five years following Medicaid expansion.

```{r estimate models, include = FALSE}
# Estimate two models, one for the period up until two years after expansion, another for the period up to four years after expansion

panel_t_2 <- YC_panel %>%
  filter(t_expansion < 2)

panel_t_4 <- YC_panel

models <- list(
  
  "Two Years Post-Expansion" <- feols(estimated_overdose_death_rate ~ 
                                         treat + med_income + med_age + male_pop + black_pop + hisp_pop + asian_pop | COUNTY + Year, 
                data = panel_t_2,
                weights = panel_t_2$population,
                cluster = panel_t_2$COUNTY),
  
  "Five Years Post-Expansion" <- feols(estimated_overdose_death_rate ~ 
                                         treat + med_income + med_age + male_pop + black_pop + hisp_pop + asian_pop | COUNTY + Year, 
                data = panel_t_4,
                weights = panel_t_4$population,
                cluster = panel_t_4$COUNTY)
)

names(models) <- c("Two Years Post-Expansion", "Five Years Post-Expansion")

#set up an object to customize your regression table goodness-of-fit statistics
gm <- tibble::tribble(
    ~raw,        ~clean,          ~fmt,
    "nobs",               "N",                  0,
    "r.squared",          "R-squared",      3,
    "adj.r.squared",      "Adj. R-squared", 3,
    "FE: COUNTY",         "County FEs",          0,
    "FE: Year",    "Year FEs",    0
    )

#display results with added formatting options    
estimation_results <- modelsummary(models,
             fmt = "%.4f",
             coef_omit = 'Intercept',
             coef_rename = c("treat" = "Medicaid Expansion", 
                             "med_income" = "Median Income ($)",
                             "med_age" = "Median Age",
                             "male_pop" = "Male Population Share (0-100)",
                             "black_pop" = "Black Population Share",
                             "hisp_pop" = "Hispanic Population Share",
                             "asian_pop" = "Asian Population Share"),
             gof_map = gm,
             title = 'Effect of Medicaid Expansion on Drug Overdose Death Rates',
             stars = c('*' = .1, '**' = .05, '***' = .01),
             notes = 'Robust standard errors clustered by county are shown in parentheses.
                      Observations are weighted by the population in each county.') %>% 
  kable_styling(latex_options = c("hold_position", "scale_down"))

```

```{r display estimates, echo = FALSE}
estimation_results
```

## Discussion {.smaller .build}

* Our estimates provide significant evidence for the conclusion that Medicaid expansion in Appalachian states had the unintended consequence of ***increasing*** deaths from drug overdose. A possible mechanism for this result is increased access to prescription opioids.

* Our findings differ from previous studies on the effect of Medicaid expansion on overdose deaths. However, one of these studies [Swartz and Beltran (2019)](https://onlinelibrary.wiley.com/doi/epdf/10.1111/add.14741), did find that expansion increased the supply of prescription opioids and that there could be a lagged increase in overdose deaths.

* Key limitations include potential OVB due to county-year variation in number of Substance Use Disorder (SUD) treatment facilities and lack of external validity outside of Appalachia. The latter limitation could explain why our results differ from previous studies.










